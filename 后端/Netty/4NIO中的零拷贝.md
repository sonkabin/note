# NIO中的零拷贝

## mmap（内存映射）和sendFile

**传统IO进行4次拷贝**，DMA拷贝（直接内存拷贝，不使用CPU）到内核缓冲区；内核缓冲区拷贝到用户态（CPU拷贝）；用户态拷贝到socket缓冲区（CPU拷贝）；内核态DMA拷贝

**mmap进行3次拷贝**：DMA拷贝；内核缓冲区拷贝到socket缓冲区（CPU拷贝）；DMA拷贝。通过用户空间和内核空间共享内存实现

**sendFile进行2次拷贝**：DMA拷贝；内核缓冲区到socket缓冲区只拷贝描述信息，消耗很少可忽略（CPU拷贝）；DMA拷贝。可以看成只进行了两次拷贝

### mmap和sendFile的区别

1. mmap适合小数据量的读写，sendFile适合大文件传输
2. sendFile减少了CPU拷贝，而mmap必须从内核缓冲区拷贝到socket缓冲区

### 零拷贝

从OS角度来说，在内核缓冲区里，没有数据是重复的。即减少CPU拷贝

优点：

1. 更少的数据复制
2. 更少的上下文切换（用户态和内核态的切换）